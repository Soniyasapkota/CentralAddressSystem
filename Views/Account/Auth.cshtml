@{
    ViewData["Title"] = "Auth";
    Layout = null; // Override layout for full screen
}

@model CentralAddressSystem.ViewModels.AuthViewModel
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login/Register</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/Auth.css" asp-append-version="true" />
</head>
<body>
    <div class="container">
        @if (TempData["Error"] != null)
        {
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                @TempData["Error"]
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        }
        @if (TempData["Message"] != null)
        {
            <div class="alert alert-success alert-dismissible fade show" role="alert">
                @TempData["Message"]
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        }

        <!-- Validation Error Modal -->
        <div class="modal fade" id="validationModal" tabindex="-1" aria-labelledby="validationModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="validationModalLabel">Form Errors</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <ul id="errorList"></ul>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">OK</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- REGISTER PANEL -->
        <div class="panel register-panel @(ViewData["ShowLogin"]?.ToString() == "true" ? "hidden" : "visible")">
            <div class="left">
                <h1>Don't have an account?</h1>
                <p>Register to access all the features of our service.<br>Manage your trips and bookings in one place. Itâ€™s free!</p>
                <div class="social-icons">
                    <i class="fab fa-instagram"></i>
                    <i class="fab fa-facebook"></i>
                    <i class="fab fa-twitter"></i>
                    <i class="fab fa-youtube"></i>
                </div>
            </div>
            <div class="right">
                <h2>Sign up</h2>
                <form asp-action="Register" asp-controller="Account" method="post" asp-antiforgery="true" id="registerForm">
                    <div class="form-group">
                        <label asp-for="Register.FirstName">First Name</label>
                        <input asp-for="Register.FirstName" class="form-control" name="Register.FirstName" />
                        <span asp-validation-for="Register.FirstName" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="Register.LastName">Last Name</label>
                        <input asp-for="Register.LastName" class="form-control" name="Register.LastName" />
                        <span asp-validation-for="Register.LastName" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="Register.Email">Email</label>
                        <input asp-for="Register.Email" class="form-control" name="Register.Email" />
                        <span asp-validation-for="Register.Email" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="Register.Username">Username</label>
                        <input asp-for="Register.Username" class="form-control" name="Register.Username" />
                        <span asp-validation-for="Register.Username" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="Register.Password">Password</label>
                        <input asp-for="Register.Password" class="form-control" type="password" name="Register.Password" />
                        <span asp-validation-for="Register.Password" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="Register.ConfirmPassword">Confirm Password</label>
                        <input asp-for="Register.ConfirmPassword" class="form-control" type="password" name="Register.ConfirmPassword" />
                        <span asp-validation-for="Register.ConfirmPassword" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <input type="checkbox" id="privacyPolicy" name="privacyPolicy" required />
                        <label for="privacyPolicy">I agree with <a href="/Home/Privacy">Privacy Policy</a></label>
                    </div>
                    <button type="submit">Sign up</button>
                    <div asp-validation-summary="All" class="text-danger"></div>
                </form>
                <div class="switch-link">
                    Already have an account? <a onclick="switchToLogin()">Login</a>
                </div>
            </div>
        </div>

    <!-- LOGIN PANEL -->
        <div class="panel login-panel @(ViewData["ShowLogin"]?.ToString() == "true" ? "visible" : "hidden")">
            <div class="right">
                <h2>Login</h2>
                <form asp-action="Login" asp-controller="Account" method="post" asp-antiforgery="true" id="loginForm">
                    <div class="form-group">
                        <label asp-for="Login.Email"></label>
                        <input asp-for="Login.Email" class="form-control" name="Login.Email" />
                        <span asp-validation-for="Login.Email" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="Login.Password"></label>
                        <input asp-for="Login.Password" class="form-control" type="password" name="Login.Password" />
                        <span asp-validation-for="Login.Password" class="text-danger"></span>
                    </div>
                    <button type="submit">Login</button>
                    <div asp-validation-summary="All" class="text-danger"></div>
                </form>
                <div class="switch-link">
                    Don't have an account? <a onclick="switchToRegister()">Sign up</a>
                </div>
            </div>
            <div class="left">
                <h1>Welcome back!</h1>
                <p>Login to access your trips and bookings.<br>Explore more with us!</p>
                <div class="social-icons">
                    <i class="fab fa-instagram"></i>
                    <i class="fab fa-facebook"></i>
                    <i class="fab fa-twitter"></i>
                    <i class="fab fa-youtube"></i>
                </div>
            </div>
        </div>
    </div>

   <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.5/jquery.validate.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validation-unobtrusive/4.0.0/jquery.validate.unobtrusive.min.js"></script>
    <script>
        function switchToLogin() {
            document.querySelector('.register-panel').classList.remove('visible');
            document.querySelector('.register-panel').classList.add('hidden');
            document.querySelector('.login-panel').classList.remove('hidden');
            document.querySelector('.login-panel').classList.add('visible');
        }

        function switchToRegister() {
            document.querySelector('.login-panel').classList.remove('visible');
            document.querySelector('.login-panel').classList.add('hidden');
            document.querySelector('.register-panel').classList.remove('hidden');
            document.querySelector('.register-panel').classList.add('visible');
        }

        $(document).ready(function () {
    // Configure jQuery Validate for the register form
    $("#registerForm").validate({
        errorElement: "span",
        errorClass: "text-danger",
        highlight: function (element) {
            $(element).addClass("is-invalid");
        },
        unhighlight: function (element) {
            $(element).removeClass("is-invalid");
        },
        errorPlacement: function (error, element) {
            error.insertAfter(element);
        },
        submitHandler: function (form) {
            console.log("Register form is valid, submitting...");
            console.log("Register form data:", $(form).serialize());
            form.submit(); // Allow form submission
        }
    });

    // Configure jQuery Validate for the login form
    $("#loginForm").validate({
        errorElement: "span",
        errorClass: "text-danger",
        highlight: function (element) {
            $(element).addClass("is-invalid");
        },
        unhighlight: function (element) {
            $(element).removeClass("is-invalid");
        },
        errorPlacement: function (error, element) {
            error.insertAfter(element);
        },
        rules: {
            "Login.Email": {
                required: true,
                email: true
            },
            "Login.Password": {
                required: true
            }
        },
        messages: {
            "Login.Email": {
                required: "Email is required.",
                email: "Please enter a valid email address."
            },
            "Login.Password": {
                required: "Password is required."
            }
        },
        submitHandler: function (form) {
            console.log("Login form is valid, submitting...");
            console.log("Login form data:", $(form).serialize());
            form.submit(); // Allow form submission
        }
    });

    // Ensure initial panel state
    var showLogin = "@(ViewData["ShowLogin"]?.ToString() == "true" ? "true" : "false")";
    if (showLogin === "true") {
        switchToLogin();
    } else {
        switchToRegister();
    }
});
    </script>
</body>
</html>